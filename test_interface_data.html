<!DOCTYPE html>
<html>
<head>
    <title>Interface Data Test</title>
</head>
<body>
    <h1>Interface Data Test</h1>
    <input type="file" id="fileInput" accept=".json,.csv">
    <button onclick="testInterfaceData()">Test Interface Data</button>
    <div id="result"></div>

    <script>
        let uploadedData = null;

        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const fileExtension = file.name.split('.').pop().toLowerCase();
                    
                    if (fileExtension === 'json') {
                        uploadedData = JSON.parse(e.target.result);
                    } else if (fileExtension === 'csv') {
                        uploadedData = parseCSV(e.target.result);
                    } else {
                        throw new Error('Unsupported file format');
                    }

                    console.log('Parsed data:', uploadedData);
                    document.getElementById('result').innerHTML = `<p>File loaded: ${file.name}</p>`;
                } catch (error) {
                    console.error('Error:', error);
                    document.getElementById('result').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                }
            };
            reader.readAsText(file);
        });

        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = {};
            
            headers.forEach(header => {
                data[header] = [];
            });
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                    headers.forEach((header, index) => {
                        let value = values[index] || '';
                        if (header.toLowerCase().includes('amount') || header.toLowerCase().includes('price')) {
                            value = parseFloat(value.replace('$', '').replace(',', '')) || 0;
                        }
                        data[header].push(value);
                    });
                }
            }
            
            return data;
        }

        function testInterfaceData() {
            if (!uploadedData) {
                alert('Please upload a file first.');
                return;
            }

            const config = {
                enable_ai: true,
                ai_vendor_enabled: true,
                ai_category_enabled: true,
                enable_transaction_intelligence: true,
                enable_source_tracking: true,
                ai_confidence_threshold: 0.7
            };

            const requestData = {
                data: uploadedData,
                config: config
            };

            console.log('Interface would send:', requestData);
            
            document.getElementById('result').innerHTML = `
                <h2>Interface Data Structure:</h2>
                <p><strong>Data type:</strong> ${typeof uploadedData}</p>
                <p><strong>Data keys:</strong> ${Object.keys(uploadedData).join(', ')}</p>
                <p><strong>Data length:</strong> ${Array.isArray(uploadedData) ? uploadedData.length : Object.keys(uploadedData).length}</p>
                <h3>Full request data:</h3>
                <pre>${JSON.stringify(requestData, null, 2)}</pre>
            `;
        }
    </script>
</body>
</html> 